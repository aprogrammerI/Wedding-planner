

 User Budget Section
<div class="card mb-4">
  <div class="card-body d-flex align-items-center gap-3 flex-wrap">
    <label class="form-label mb-0">Your Budget:</label>

    <input
      type="number"
      [(ngModel)]="budget"
      (ngModelChange)="onBudgetChange($event)"
      class="form-control w-auto"
      min="0"
      style="max-width: 180px;"
      placeholder="Enter your budget"
    />

    <span class="ms-2 text-muted" *ngIf="budget > 0">({{ budget | currency }})</span>
    <span class="ms-4">
      <strong>Remaining:</strong>
      <span [ngClass]="{'text-danger fw-bold': remainingBudget < 0, 'text-success': remainingBudget >= 0}">
        {{ remainingBudget | currency }}
      </span>
      <span *ngIf="remainingBudget < 0" class="badge bg-danger ms-2">Over!</span>
    </span>
  </div>
</div>

<div class="mb-3 row">
  <div class="col">
    <input [(ngModel)]="newName" class="form-control" placeholder="Item name" />
  </div>
  <div class="col">
    <input type="number" [(ngModel)]="newAmount" class="form-control" placeholder="Amount" />
  </div>
  <div class="col">
    <select [(ngModel)]="newCategory" class="form-select">
      <option value="">Select category</option>
      <option *ngFor="let c of categories" [value]="c">{{ c }}</option>
    </select>
  </div>
  <div class="col-auto">
    <button (click)="add()" class="btn btn-primary">Add</button>
  </div>
</div>

<ul class="list-group mb-3">
  <li *ngFor="let e of expenses" class="list-group-item">
    <div class="d-flex justify-content-between align-items-center" *ngIf="editingId !== e.id; else editRow">
      <div>
        <div class="fw-semibold">{{ e.name }}</div>
        <div class="text-muted small" *ngIf="e.category">{{ e.category }}</div>
      </div>
      <div class="d-flex align-items-center gap-2">
        <strong>{{ e.amount | currency }}</strong>
        <div class="budget-actions">
          <mat-icon class="edit-icon" (click)="startEdit(e)" title="Edit Item">edit</mat-icon>
          <mat-icon class="delete-icon" (click)="remove(e.id)" title="Delete Item">delete</mat-icon>
        </div>
      </div>
    </div>

    <ng-template #editRow>
      <div class="row g-2 align-items-end">
        <div class="col-md-5">
          <label class="form-label">Name</label>
          <input [(ngModel)]="editDraft.name" class="form-control form-control-sm" />
        </div>
        <div class="col-md-3">
          <label class="form-label">Amount</label>
          <input type="number" [(ngModel)]="editDraft.amount" class="form-control form-control-sm" />
        </div>
        <div class="col-md-2">
          <label class="form-label">Category</label>
          <select [(ngModel)]="editDraft.category" class="form-select form-select-sm">
            <option value="">Select category</option>
            <option *ngFor="let c of categories" [value]="c">{{ c }}</option>
          </select>
        </div>
        <div class="col-md-2 d-flex gap-2">
          <button (click)="saveEdit()" class="btn btn-sm btn-primary">Save</button>
          <button (click)="cancelEdit()" class="btn btn-sm btn-outline-secondary">Cancel</button>
        </div>
      </div>
    </ng-template>
  </li>
</ul>

<div class="row mt-4">
  <div class="col-md-5">
    <div class="pie mb-3" [ngStyle]="{ 'background-image': pieGradient }"></div>
    <ul class="list-unstyled small mb-0 ps-2">
      <li *ngFor="let s of categorySlices" class="d-flex align-items-center mb-1">
        <span class="legend me-2" [ngStyle]="{ 'background-color': s.color }"></span>
        <span>{{ s.category }}</span>
      </li>
    </ul>
  </div>
  <div class="col-md-7">
    <h6 class="mb-3">Breakdown</h6>
    <div class="table-responsive">
      <table class="table table-sm align-middle mb-0 budget-breakdown-table">
        <thead>
        <tr>
          <th>Category</th>
          <th>Spent</th>
          <th>Limit</th>
          <th>Status</th>
        </tr>
        </thead>
        <tbody>
        <tr *ngFor="let s of categorySlices">
          <td>{{ s.category }}</td>
          <td>{{ s.amount | currency }} <span class="text-muted">({{ s.percent | number:'1.0-0' }}%)</span></td>
          <td style="min-width:120px;">


            <input type="number" min="0" class="form-control form-control-sm d-inline w-auto" style="max-width: 90px;"
                   [(ngModel)]="categoryLimits[mapStringToCategoryType(s.category)]"
                   [ngModelOptions]="{ updateOn: 'blur' }"
                   (change)="setCategoryLimit(s.category, categoryLimits[mapStringToCategoryType(s.category)])"
                   placeholder="Limit" title="Set limit for {{s.category}}" />


          </td>
          <td>
            <span *ngIf="isCategoryOverLimit(s.category, s.amount)" class="badge bg-danger">Over!</span>
            <span *ngIf="!isCategoryOverLimit(s.category, s.amount) && getCategoryLimit(s.category) > 0" class="badge bg-success">OK</span>
          </td>
        </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>

<div class="text-end mt-3">
  Total: <strong>{{ total() | currency }}</strong>
  <span *ngIf="overBudget" class="badge bg-danger ms-2">Over Budget!</span>
</div>










